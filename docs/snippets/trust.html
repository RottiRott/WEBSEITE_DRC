<!DOCTYPE html>
<html class="scroll-smooth" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Kundenstimmen & FAQ – DachrinneCheck</title>
<!-- FIX: Provide canonical URL for SEO and Wix embedding -->
<link href="https://www.dachrinnecheck.de/" rel="canonical"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#0077B6",
            "primary-dark": "#005E90",
            "background-light": "#F8F9FA",
            "background-dark": "#1A202C",
            "text-light": "#6C757D",
            "text-dark": "#E2E8F0",
            "card-light": "#FFFFFF",
            "card-dark": "#2D3748",
          },
          fontFamily: {
            display: ["Poppins", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
            lg: "0.75rem",
            xl: "1rem",
            full: "9999px",
          },
          boxShadow: {
            'custom': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',
          }
        },
      },
    };
  </script>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<link href="assets/css/responsive-nav.css" rel="stylesheet"/>
<script defer src="assets/js/responsive-nav.js"></script>
<style>
    .text-shadow {
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }
    :root {
      --hero-safe-bottom: 0px;
    }
    @supports (padding: max(0px)) {
      :root {
        --hero-safe-bottom: env(safe-area-inset-bottom);
      }
    }
    /* FIX: Responsive hero media container without parallax tearing */
    .hero-section {
      position: relative;
      isolation: isolate;
      min-height: clamp(24rem, 62vh, 40rem);
      display: grid;
      align-items: center;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .hero-section {
        min-height: clamp(28rem, 70vh, 48rem);
      }
    }
    .hero-media {
      position: absolute;
      inset: 0;
      z-index: -2;
      overflow: hidden;
    }
    .hero-media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
    }
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 24, 47, 0.45), rgba(0, 0, 0, 0.55));
      z-index: -1;
    }
    .hero-content {
      padding: clamp(2.25rem, 8vw, 3.5rem) clamp(1.5rem, 5vw, 4rem)
        max(clamp(1.75rem, 7vw, 3rem), calc(1.75rem + var(--hero-safe-bottom)));
      width: min(100%, 720px);
    }
    @media (min-width: 768px) {
      .hero-content {
        padding: clamp(4rem, 10vw, 7rem) clamp(1.5rem, 5vw, 4rem) clamp(3rem, 8vw, 6.5rem);
      }
    }
    .hero-title {
      font-size: clamp(2.35rem, 8vw, 3.35rem);
      line-height: 1.1;
      letter-spacing: -0.015em;
    }
    @media (min-width: 640px) {
      .hero-title {
        font-size: clamp(2.75rem, 6vw, 4.75rem);
      }
    }
    .hero-subtitle {
      font-size: clamp(1rem, 4.6vw, 1.35rem);
    }
    @media (min-width: 640px) {
      .hero-subtitle {
        font-size: clamp(1.125rem, 3.2vw, 1.75rem);
      }
    }
    .hero-cta {
      gap: clamp(0.75rem, 3vw, 1.25rem);
    }
    @media (min-width: 640px) {
      .hero-cta {
        gap: clamp(1rem, 2vw, 1.75rem);
      }
    }
    @media (max-width: 639px) {
      .hero-cta {
        width: min(100%, 25rem);
        margin-inline: auto;
      }
    }
    [x-cloak] {
      display: none !important;
    }
    .hover-lift {
        transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
    }
    .hover-lift:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 35px -10px rgba(0, 0, 0, 0.15), 0 12px 15px -8px rgba(0, 0, 0, 0.15);
    }
    @keyframes reveal {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .reveal {
      animation: reveal 0.8s ease-out forwards;
      animation-timeline: view();
      animation-range: entry 20% cover 40%;
    }
</style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative w-full overflow-x-hidden">
<section class="py-16 md:py-20 px-4 bg-card-light dark:bg-card-dark reveal">
<div class="container mx-auto">
<h2 class="text-3xl md:text-4xl font-bold text-center mb-4 md:mb-6 text-gray-900 dark:text-white">Was unsere Kunden sagen</h2>
<p class="text-base md:text-lg text-text-light dark:text-text-dark text-center mb-8 md:mb-12 max-w-2xl mx-auto">Hören Sie von unseren zufriedenen Kunden und erfahren Sie, warum sie DachrinneCheck vertrauen.</p>
<div class="relative max-w-3xl mx-auto" x-data="reviewsCarousel()" x-init="init()" x-cloak>
<div class="bg-white/70 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 text-center rounded-xl py-8" x-show="!ready && !error">
<p class="font-medium">Kundenstimmen werden geladen …</p>
</div>
<div class="bg-red-50 border border-red-200 text-red-700 dark:bg-red-900/30 dark:border-red-700 dark:text-red-200 rounded-xl p-6 text-center" x-show="error" x-transition>
<p class="font-semibold" x-text="error"></p>
</div>
<div @mouseenter="stopAutoRotate()" @mouseleave="startAutoRotate()" class="relative" x-show="ready" x-transition>
<div class="overflow-hidden">
<div :style="`transform: translateX(-${activeIndex * 100}%)`" class="flex transition-transform duration-500 ease-in-out">
<template x-for="(review, index) in reviews" :key="review.id || index">
<div class="flex-shrink-0 w-full p-2">
<div class="bg-background-light dark:bg-background-dark rounded-xl shadow-custom p-6 md:p-8 text-center hover-lift relative">
<template x-if="review.highlighted">
<span class="absolute top-4 right-4 bg-primary text-white text-xs font-semibold uppercase tracking-wide px-3 py-1 rounded-full">Top-Bewertung</span>
</template>
<div class="flex justify-center mb-4">
<img :alt="`Avatar von ${review.name}`" :src="avatarUrl(review)" class="w-20 h-20 md:w-24 md:h-24 rounded-full object-cover border-4 border-white shadow"/>
</div>
<div class="flex flex-wrap justify-center items-center gap-2 mb-3" x-show="review.verified || review.source">
<template x-if="review.verified">
<span class="flex items-center text-xs font-semibold text-green-700 bg-green-100 dark:text-green-200 dark:bg-green-900/60 px-3 py-1 rounded-full">
<span class="material-symbols-outlined text-base mr-1">verified</span>
Verifiziert
</span>
</template>
<template x-if="review.source">
<span class="text-xs text-text-light dark:text-text-dark px-3 py-1 rounded-full border border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-800/70" x-text="review.source"></span>
</template>
</div>
<div class="flex justify-center text-yellow-400 mb-4">
<template x-for="star in 5" :key="`${review.id || index}-star-${star}`">
<span class="material-symbols-outlined" x-text="starIcon(star, review.rating)"></span>
</template>
</div>
<p class="text-base md:text-lg text-text-light dark:text-text-dark italic mb-4">&bdquo;<span x-text="review.text"></span>&ldquo;</p>
<p class="font-bold text-gray-900 dark:text-white" x-text="review.name"></p>
<p class="text-sm text-text-light dark:text-text-dark mb-3" x-text="formatMeta(review)"></p>
<template x-if="review.link">
<p class="text-sm">
<a :href="review.link" class="text-primary hover:text-primary-dark font-medium inline-flex items-center gap-1" rel="noopener" target="_blank">
Original lesen
<span class="material-symbols-outlined text-base">open_in_new</span>
</a>
</p>
</template>
</div>
</div>
</template>
</div>
</div>
<button :aria-disabled="reviews.length <= 1" :class="{'opacity-40 cursor-not-allowed': reviews.length <= 1}" @click="previous" class="absolute top-1/2 -translate-y-1/2 left-0 -translate-x-4 md:-translate-x-1/2 bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition transform hover:scale-110" type="button">
<span class="material-symbols-outlined text-primary">chevron_left</span>
</button>
<button :aria-disabled="reviews.length <= 1" :class="{'opacity-40 cursor-not-allowed': reviews.length <= 1}" @click="next" class="absolute top-1/2 -translate-y-1/2 right-0 translate-x-4 md:translate-x-1/2 bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition transform hover:scale-110" type="button">
<span class="material-symbols-outlined text-primary">chevron_right</span>
</button>
</div>
  <div class="flex justify-center space-x-2 mt-6 md:mt-8" x-show="ready && reviews.length > 1">
<template x-for="(review, index) in reviews" :key="`${review.id || index}-indicator`">
<button :aria-label="`Bewertung ${index + 1} anzeigen`" :class="{'bg-primary scale-110': activeIndex === index, 'bg-gray-300 dark:bg-gray-600': activeIndex !== index}" @click="goTo(index)" class="w-3 h-3 rounded-full transition transform" type="button"></button>
</template>
  </div>
  </div>
  <div class="mt-12" id="dynamic-reviews">
    <div class="text-center max-w-3xl mx-auto mb-8">
      <h3 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white">Aktuelle Kundenbewertungen</h3>
      <p class="text-base md:text-lg text-text-light dark:text-text-dark">Echte Rückmeldungen aus unserer Reviews-CMS-Sammlung – automatisch aktualisiert.</p>
    </div>
    <div class="max-w-4xl mx-auto space-y-6">
      <div class="bg-white/70 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 rounded-xl p-6 text-center" id="reviews-loading">
        <p class="font-medium">Bewertungen werden geladen …</p>
      </div>
      <div class="hidden bg-red-50 border border-red-200 text-red-700 dark:bg-red-900/30 dark:border-red-700 dark:text-red-200 rounded-xl p-6 text-center" id="reviews-error"></div>
      <div class="hidden text-text-light dark:text-text-dark text-center" id="reviews-empty">Noch keine veröffentlichten Bewertungen vorhanden.</div>
      <div class="grid gap-6 md:grid-cols-2" id="reviews-list"></div>
    </div>
  </div>
  </div>
</section>

<section class="py-16 md:py-20 px-4 bg-background-light dark:bg-background-dark reveal">
<div class="container mx-auto max-w-3xl">
<h2 class="text-3xl md:text-4xl font-bold text-center text-gray-900 dark:text-white mb-8 md:mb-12">Häufig gestellte Fragen</h2>
<div class="space-y-4 md:space-y-6" x-data="{ open: null }">
<div class="bg-card-light dark:bg-card-dark rounded-xl shadow-sm hover-lift reveal">
<button @click="open === 1 ? open = null : open = 1" class="w-full text-left p-4 md:p-6 flex justify-between items-center">
<span class="font-semibold text-base md:text-xl text-gray-900 dark:text-white">Wie oft sollte ich meine Dachrinnen reinigen lassen?</span>
<svg :class="{ 'rotate-180': open === 1 }" class="w-6 h-6 text-primary transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
<div class="px-4 md:px-6 pb-4 md:pb-6 text-text-light dark:text-text-dark text-sm md:text-base" x-show="open === 1" x-transition:enter="transition ease-out duration-300" x-transition:enter-end="opacity-100 translate-y-0" x-transition:enter-start="opacity-0 -translate-y-2" x-transition:leave="transition ease-in duration-200" x-transition:leave-end="opacity-0 -translate-y-2" x-transition:leave-start="opacity-100 translate-y-0">
<p>Wir empfehlen, Ihre Dachrinnen mindestens zweimal im Jahr reinigen zu lassen, typischerweise im Frühjahr und Herbst. Wenn Ihr Grundstück von vielen Bäumen umgeben ist, kann eine häufigere Reinigung erforderlich sein.</p>
</div>
</div>
<div class="bg-card-light dark:bg-card-dark rounded-xl shadow-sm hover-lift reveal">
<button @click="open === 2 ? open = null : open = 2" class="w-full text-left p-4 md:p-6 flex justify-between items-center">
<span class="font-semibold text-base md:text-xl text-gray-900 dark:text-white">Was ist Ihr Servicegebiet in NRW?</span>
<svg :class="{ 'rotate-180': open === 2 }" class="w-6 h-6 text-primary transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
<div class="px-4 md:px-6 pb-4 md:pb-6 text-text-light dark:text-text-dark text-sm md:text-base" x-show="open === 2" x-transition:enter="transition ease-out duration-300" x-transition:enter-end="opacity-100 translate-y-0" x-transition:enter-start="opacity-0 -translate-y-2" x-transition:leave="transition ease-in duration-200" x-transition:leave-end="opacity-0 -translate-y-2" x-transition:leave-start="opacity-100 translate-y-0">
<p>Wir bieten unsere Dachrinnenreinigungsdienste in der gesamten Region Nordrhein-Westfalen (NRW) an. Kontaktieren Sie uns mit Ihrer Adresse, um zu bestätigen, ob wir Ihren spezifischen Standort bedienen.</p>
</div>
</div>
<div class="bg-card-light dark:bg-card-dark rounded-xl shadow-sm hover-lift reveal">
<button @click="open === 3 ? open = null : open = 3" class="w-full text-left p-4 md:p-6 flex justify-between items-center">
<span class="font-semibold text-base md:text-xl text-gray-900 dark:text-white">Wie wird der Preis für die Dachrinnenreinigung bestimmt?</span>
<svg :class="{ 'rotate-180': open === 3 }" class="w-6 h-6 text-primary transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
<div class="px-4 md:px-6 pb-4 md:pb-6 text-text-light dark:text-text-dark text-sm md:text-base" x-show="open === 3" x-transition:enter="transition ease-out duration-300" x-transition:enter-end="opacity-100 translate-y-0" x-transition:enter-start="opacity-0 -translate-y-2" x-transition:leave="transition ease-in duration-200" x-transition:leave-end="opacity-0 -translate-y-2" x-transition:leave-start="opacity-100 translate-y-0">
<p>Die Kosten unseres Service hängen von mehreren Faktoren ab, darunter die Länge Ihrer Dachrinnen, die Höhe Ihres Gebäudes und die Menge an Schmutz. Nutzen Sie gern unseren <a class="text-primary hover:text-primary-dark font-semibold" href="https://www.dachrinnecheck.de/kostenrechner">Kostenrechner</a>, um in wenigen Sekunden einen transparenten Richtpreis zu erhalten. Anschließend erstellen wir Ihnen ein kostenloses, unverbindliches Angebot, damit Sie den genauen Preis im Voraus kennen.</p>
</div>
</div>
</div>
</div>
</section>
</div>

<script>
  const detectFunctionsBase = () => {
    try {
      if (typeof window !== 'undefined') {
        const { hostname = '' } = window.location || {};
        const normalized = String(hostname).toLowerCase();
        if (normalized.includes('wixsite') || normalized.includes('editor')) {
          return '/_functions-dev';
        }
      }
    } catch (error) {
      console.warn('Konnte Umgebung für Functions-Endpunkte nicht bestimmen:', error);
    }
    return '/_functions';
  };

  const FUNCTIONS_BASE = detectFunctionsBase();

  const createReviewEndpoints = limit => {
    const parsedLimit = Number.parseInt(limit, 10);
    const safeLimit = Number.isFinite(parsedLimit) && parsedLimit > 0 ? parsedLimit : 10;
    const alternateBase = FUNCTIONS_BASE === '/_functions' ? '/_functions-dev' : '/_functions';
    const endpoints = [
      `${FUNCTIONS_BASE}/reviews?limit=${safeLimit}`,
      `${alternateBase}/reviews?limit=${safeLimit}`,
      `https://www.dachrinnecheck.de/_functions/reviews?limit=${safeLimit}`
    ];
    return [...new Set(endpoints)];
  };

  const REVIEWS_ENDPOINTS = createReviewEndpoints(20);

  function reviewsCarousel() {
    return {
      reviews: [],
      activeIndex: 0,
      ready: false,
      error: '',
      autoRotateId: null,
      async init() {
        this.stopAutoRotate();
        this.error = '';
        this.ready = false;
        this.reviews = [];

        try {
          let payload = null;
          let lastError = null;

          for (const endpoint of REVIEWS_ENDPOINTS) {
            try {
              const response = await fetch(endpoint, { cache: 'no-store' });
              if (!response.ok) {
                throw new Error(`Konnte Rezensionen nicht laden (Status ${response.status}).`);
              }

              payload = await response.json();

              if (payload?.ok === false) {
                const message = payload?.error || 'Die Kundenrezensionen konnten nicht geladen werden.';
                throw new Error(message);
              }

              break;
            } catch (fetchError) {
              lastError = fetchError;
            }
          }

          if (!payload) {
            throw lastError || new Error('Die Kundenrezensionen konnten nicht geladen werden.');
          }

          const rawItems = Array.isArray(payload?.items) ? payload.items : [];

          if (!rawItems.length) {
            throw new Error('Keine Rezensionen in der Datenquelle gefunden.');
          }

          const formatDate = value => {
            if (!value) {
              return '';
            }
            const date = value instanceof Date ? value : new Date(value);
            if (Number.isNaN(date.getTime())) {
              return typeof value === 'string' ? value : '';
            }
            return date.toLocaleDateString('de-DE', { day: '2-digit', month: 'long', year: 'numeric' });
          };

          const toBoolean = value => {
            if (typeof value === 'string') {
              const normalized = value.trim().toLowerCase();
              return ['true', '1', 'yes', 'ja'].includes(normalized);
            }
            return Boolean(value);
          };

          const normalized = rawItems.map((item, index) => {
            const safeItem = item || {};
            const name = typeof safeItem.name === 'string' ? safeItem.name.trim() : '';
            const comment = typeof safeItem.comment === 'string'
              ? safeItem.comment.trim()
              : (typeof safeItem.text === 'string' ? safeItem.text.trim() : '');
            const ratingSource = safeItem.rating ?? safeItem.score ?? safeItem.stars;
            const ratingValue = Number.parseFloat(ratingSource);

            return {
              id: safeItem.id || `review-${index}`,
              name: name || 'Anonymer Kunde',
              text: comment,
              rating: Number.isFinite(ratingValue) ? ratingValue : 0,
              city: typeof safeItem.city === 'string' ? safeItem.city.trim() : '',
              date: formatDate(safeItem.date),
              source: typeof safeItem.source === 'string' ? safeItem.source.trim() : '',
              link: typeof safeItem.link === 'string' ? safeItem.link.trim() : '',
              avatar: typeof safeItem.avatar === 'string' ? safeItem.avatar.trim() : '',
              highlighted: toBoolean(safeItem.highlighted),
              verified: toBoolean(safeItem.verified)
            };
          });

          const withTexts = normalized.filter(review => review.text.length > 0);

          if (!withTexts.length) {
            throw new Error('Keine veröffentlichten Rezensionstexte vorhanden.');
          }

          this.reviews = withTexts;
          this.shuffleReviews();
          this.ready = true;
          this.startAutoRotate();
        } catch (loadError) {
          console.error(loadError);
          this.error = loadError?.message || 'Die Kundenrezensionen konnten nicht geladen werden.';
        }
      },
      shuffleReviews() {
        for (let index = this.reviews.length - 1; index > 0; index--) {
          const swapIndex = Math.floor(Math.random() * (index + 1));
          [this.reviews[index], this.reviews[swapIndex]] = [this.reviews[swapIndex], this.reviews[index]];
        }
        this.activeIndex = 0;
      },
      next() {
        if (!this.reviews.length) {
          return;
        }
        this.activeIndex = (this.activeIndex + 1) % this.reviews.length;
        this.startAutoRotate();
      },
      previous() {
        if (!this.reviews.length) {
          return;
        }
        this.activeIndex = (this.activeIndex - 1 + this.reviews.length) % this.reviews.length;
        this.startAutoRotate();
      },
      goTo(index) {
        if (typeof index !== 'number' || index < 0 || index >= this.reviews.length) {
          return;
        }
        this.activeIndex = index;
        this.startAutoRotate();
      },
      startAutoRotate() {
        this.stopAutoRotate();
        if (this.reviews.length <= 1) {
          return;
        }
        this.autoRotateId = setInterval(() => {
          if (document.hidden) {
            return;
          }
          this.activeIndex = (this.activeIndex + 1) % this.reviews.length;
        }, 9000);
      },
      stopAutoRotate() {
        if (this.autoRotateId) {
          clearInterval(this.autoRotateId);
          this.autoRotateId = null;
        }
      },
      avatarUrl(review) {
        if (review.avatar) {
          return review.avatar;
        }
        const name = review.name || 'Kunde';
        const initials = encodeURIComponent(name);
        return `https://ui-avatars.com/api/?background=0077B6&color=fff&name=${initials}`;
      },
      starIcon(star, rating) {
        if (rating >= star) {
          return 'star';
        }
        if (rating >= star - 0.5) {
          return 'star_half';
        }
        return 'grade';
      },
      formatMeta(review) {
        const parts = [];
        if (review.city) {
          parts.push(review.city);
        }
        if (review.date) {
          parts.push(review.date);
        }
        return parts.join(' • ');
      }
    };
  }

  document.addEventListener('DOMContentLoaded', () => {
    const contactForm = document.querySelector('#contact-form');
    if (!contactForm) {
      return;
    }

    const firstNameInput = contactForm.querySelector('#first-name');
    const lastNameInput = contactForm.querySelector('#last-name');
    const emailInput = contactForm.querySelector('#email');
    const phoneInput = contactForm.querySelector('#phone');
    const addressInput = contactForm.querySelector('#address');
    const heightInput = contactForm.querySelector('#gutter-height');
    const lengthInput = contactForm.querySelector('#gutter-length');
    const consentInput = contactForm.querySelector('#consent');
    const reasonInputs = Array.from(contactForm.querySelectorAll('input[name="reasons"]'));
    const guardInputs = Array.from(contactForm.querySelectorAll('input[name="guards"]'));
    const submitButton = contactForm.querySelector('button[type="submit"]');
    const statusContainer = contactForm.querySelector('[data-contact-status]');
    const statusMessage = contactForm.querySelector('#contact-status-message');
    const retryButton = contactForm.querySelector('[data-contact-retry]');

    if (!firstNameInput || !lastNameInput || !emailInput || !phoneInput || !addressInput || !heightInput || !lengthInput || !consentInput || !submitButton) {
      return;
    }

    const defaultButtonText = submitButton.textContent.trim();
    let isProcessing = false;

    const statusClassMap = {
      info: ['border-blue-200', 'bg-blue-50', 'text-blue-900', 'dark:bg-blue-900/30', 'dark:border-blue-700', 'dark:text-blue-100'],
      success: ['border-green-300', 'bg-green-50', 'text-green-800', 'dark:bg-green-900/30', 'dark:border-green-700', 'dark:text-green-200'],
      error: ['border-red-300', 'bg-red-50', 'text-red-700', 'dark:bg-red-900/30', 'dark:border-red-700', 'dark:text-red-200']
    };

    const removeStatusClasses = () => {
      if (!statusContainer) {
        return;
      }
      Object.values(statusClassMap).forEach((classes) => {
        classes.forEach((className) => statusContainer.classList.remove(className));
      });
    };

    const toggleRetry = (visible) => {
      if (!retryButton) {
        return;
      }
      retryButton.classList.toggle('hidden', !visible);
      retryButton.setAttribute('aria-hidden', visible ? 'false' : 'true');
    };

    const hideStatus = () => {
      if (!statusContainer) {
        return;
      }
      removeStatusClasses();
      statusContainer.classList.add('hidden');
      statusContainer.removeAttribute('data-state');
      toggleRetry(false);
    };

    // FIX: Present friendly feedback for validation, success and failure states
    const showStatus = (type, message, { showRetry = false } = {}) => {
      if (!statusContainer || !statusMessage) {
        return;
      }
      removeStatusClasses();
      const classes = statusClassMap[type] || statusClassMap.info;
      classes.forEach((className) => statusContainer.classList.add(className));
      statusContainer.classList.remove('hidden');
      statusContainer.dataset.state = type;
      statusMessage.textContent = message;
      toggleRetry(showRetry);
    };

    const setSubmitDisabled = (disabled) => {
      submitButton.disabled = disabled;
      submitButton.setAttribute('aria-disabled', disabled ? 'true' : 'false');
      submitButton.classList.toggle('opacity-60', disabled);
      submitButton.classList.toggle('cursor-not-allowed', disabled);
    };

    const updateSubmitState = () => {
      if (isProcessing) {
        return;
      }
      const shouldDisable = !contactForm.checkValidity();
      setSubmitDisabled(shouldDisable);
      if (!shouldDisable) {
        submitButton.textContent = defaultButtonText;
      }
    };

    const startProcessing = () => {
      isProcessing = true;
      hideStatus();
      setSubmitDisabled(true);
      submitButton.textContent = 'Wird gesendet…';
    };

    const stopProcessing = () => {
      isProcessing = false;
      submitButton.textContent = defaultButtonText;
      updateSubmitState();
    };

    const resetCustomValidity = () => {
      [firstNameInput, lastNameInput, emailInput, phoneInput, addressInput, heightInput, lengthInput].forEach((input) => {
        input.setCustomValidity('');
      });
    };

    const watchInputs = [firstNameInput, lastNameInput, emailInput, phoneInput, addressInput, heightInput, lengthInput];
    watchInputs.forEach((input) => {
      input.addEventListener('input', () => {
        input.setCustomValidity('');
        hideStatus();
        updateSubmitState();
      });
    });

    [consentInput, ...reasonInputs, ...guardInputs].forEach((element) => {
      element.addEventListener('change', () => {
        hideStatus();
        updateSubmitState();
      });
    });

    if (retryButton) {
      retryButton.addEventListener('click', () => {
        if (!isProcessing) {
          hideStatus();
          contactForm.requestSubmit();
        }
      });
    }

    const parseNumberInput = input => {
      if (!input) {
        return null;
      }
      const rawValue = input.value.replace(',', '.').trim();
      if (!rawValue) {
        return null;
      }
      const numericValue = Number.parseFloat(rawValue);
      return Number.isFinite(numericValue) ? numericValue : null;
    };

    contactForm.addEventListener('submit', async event => {
      event.preventDefault();

      hideStatus();
      resetCustomValidity();

      const errors = [];
      const firstName = firstNameInput.value.trim();
      const lastName = lastNameInput.value.trim();
      const emailValue = emailInput.value.trim();
      const phoneValue = phoneInput.value.trim();
      const addressValue = addressInput.value.trim();
      const heightValue = parseNumberInput(heightInput);
      const lengthValue = parseNumberInput(lengthInput);

      if (!firstName) {
        firstNameInput.setCustomValidity('Bitte geben Sie Ihren Vornamen an.');
        errors.push('Bitte geben Sie Ihren Vornamen an.');
      }

      if (!lastName) {
        lastNameInput.setCustomValidity('Bitte geben Sie Ihren Nachnamen an.');
        errors.push('Bitte geben Sie Ihren Nachnamen an.');
      }

      if (!emailValue) {
        emailInput.setCustomValidity('Bitte geben Sie Ihre E-Mail-Adresse an.');
        errors.push('Bitte geben Sie Ihre E-Mail-Adresse an.');
      } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailValue)) {
        emailInput.setCustomValidity('Bitte geben Sie eine gültige E-Mail-Adresse an.');
        errors.push('Bitte geben Sie eine gültige E-Mail-Adresse an.');
      }

      if (!phoneValue) {
        phoneInput.setCustomValidity('Bitte geben Sie eine Telefonnummer an.');
        errors.push('Bitte geben Sie eine Telefonnummer an.');
      } else if (!/^\+?[0-9 ()\-\/]{6,20}$/.test(phoneValue)) {
        phoneInput.setCustomValidity('Bitte prüfen Sie die Telefonnummer.');
        errors.push('Bitte prüfen Sie die Telefonnummer.');
      }

      if (!addressValue) {
        addressInput.setCustomValidity('Bitte geben Sie eine Adresse an.');
        errors.push('Bitte geben Sie eine Adresse an.');
      }

      if (heightValue === null || heightValue <= 0) {
        heightInput.setCustomValidity('Bitte geben Sie die geschätzte Höhe der Dachrinne an.');
        errors.push('Bitte geben Sie die geschätzte Höhe der Dachrinne an.');
      }

      if (lengthValue === null || lengthValue <= 0) {
        lengthInput.setCustomValidity('Bitte geben Sie die geschätzte Länge der Dachrinne an.');
        errors.push('Bitte geben Sie die geschätzte Länge der Dachrinne an.');
      }

      if (!consentInput.checked) {
        errors.push('Bitte bestätigen Sie die Datenschutzerklärung.');
      }

      if (errors.length) {
        contactForm.reportValidity();
        showStatus('error', errors.join(' '));
        updateSubmitState();
        return;
      }

      const selectedReasons = reasonInputs.filter(input => input.checked).map(input => input.value);
      const selectedGuards = guardInputs.filter(input => input.checked).map(input => input.value);
      const messageParts = [];
      if (selectedReasons.length) {
        messageParts.push(`Grund für die Reinigung: ${selectedReasons.join(', ')}`);
      }
      if (selectedGuards.length) {
        messageParts.push(`Dachrinnenschutz: ${selectedGuards.join(', ')}`);
      }
      const messageValue = messageParts.join(' | ');

      startProcessing();

      const contact = {
        vorname: firstName,
        nachname: lastName,
        email: emailValue,
        telefon: phoneValue,
        nachricht: messageValue,
        wunschtermin: ''
      };

      const payload = {
        typ: 'Homepage-Anfrage',
        adresse: addressValue,
        hoehe: heightValue,
        lfm: lengthValue,
        gruende: selectedReasons,
        schutzOptionen: selectedGuards
      };

      const requestBody = {
        meta: {
          source: 'homepage-form',
          version: '2.0.0',
          timestamp: new Date().toISOString()
        },
        contact,
        payload,
        consent: consentInput.checked ? 'ja' : 'nein'
      };

      try {
        const response = await fetch('/_functions/webhookbridge', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });

        let result = null;
        try {
          result = await response.json();
        } catch (jsonError) {
          // ignore JSON parsing errors – will be handled by status check below
        }

        if (!response.ok || (result && result.ok === false)) {
          const errorMessage = result?.error || `Unerwarteter Status ${response.status}`;
          throw new Error(errorMessage);
        }

        showStatus('success', 'Vielen Dank für Ihre Anfrage! Wir melden uns schnellstmöglich bei Ihnen.');
        contactForm.reset();
        updateSubmitState();
      } catch (error) {
        console.error('Fehler beim Senden des Formulars:', error);
        showStatus('error', 'Ihre Anfrage konnte nicht gesendet werden. Bitte versuchen Sie es später erneut.', { showRetry: true });
      } finally {
        stopProcessing();
      }
    });

    updateSubmitState();
  });

    document.addEventListener('DOMContentLoaded', () => {
      const reviewsSection = document.querySelector('#dynamic-reviews');
      if (!reviewsSection) {
        return;
      }

      const listElement = reviewsSection.querySelector('#reviews-list');
      const loadingElement = reviewsSection.querySelector('#reviews-loading');
      const errorElement = reviewsSection.querySelector('#reviews-error');
      const emptyElement = reviewsSection.querySelector('#reviews-empty');

      if (!listElement) {
        return;
      }

      const ENDPOINTS = createReviewEndpoints(10);

      const showElement = (element, shouldShow) => {
        if (!element) {
          return;
        }
        if (shouldShow) {
          element.classList.remove('hidden');
        } else {
          element.classList.add('hidden');
        }
      };

      const formatDate = value => {
        if (!value) {
          return '';
        }
        const date = value instanceof Date ? value : new Date(value);
        if (Number.isNaN(date.getTime())) {
          return '';
        }
        return date.toLocaleDateString('de-DE', { day: '2-digit', month: 'long', year: 'numeric' });
      };

      const clampRating = value => {
        const numeric = Number.parseFloat(value);
        if (!Number.isFinite(numeric)) {
          return 0;
        }
        return Math.min(Math.max(numeric, 0), 5);
      };

      const createStarRow = ratingValue => {
        const rating = clampRating(ratingValue);
        const container = document.createElement('div');
        container.className = 'flex items-center gap-1 text-yellow-400';
        container.setAttribute('aria-label', `${Math.round(rating * 10) / 10} von 5 Sternen`);

        for (let index = 1; index <= 5; index += 1) {
          const span = document.createElement('span');
          span.className = 'material-symbols-outlined text-xl';
          if (rating >= index) {
            span.textContent = 'star';
          } else if (rating >= index - 0.5) {
            span.textContent = 'star_half';
          } else {
            span.textContent = 'star_border';
          }
          container.appendChild(span);
        }

        const label = document.createElement('span');
        label.className = 'ml-2 text-sm font-medium text-text-light dark:text-text-dark';
        label.textContent = `${Math.round(rating * 10) / 10} / 5`;
        container.appendChild(label);

        return container;
      };

      const createReviewCard = review => {
        const card = document.createElement('article');
        card.className = 'bg-background-light dark:bg-background-dark border border-gray-200 dark:border-gray-700 rounded-xl p-6 shadow-sm flex flex-col gap-4';

        const name = document.createElement('h4');
        name.className = 'text-lg font-semibold text-gray-900 dark:text-white';
        name.textContent = review?.name || 'Kunde';
        card.appendChild(name);

        card.appendChild(createStarRow(review?.rating));

        if (review?.comment) {
          const comment = document.createElement('p');
          comment.className = 'text-sm md:text-base text-text-light dark:text-text-dark italic';
          comment.textContent = review.comment;
          card.appendChild(comment);
        }

        const meta = document.createElement('p');
        meta.className = 'text-xs text-text-light dark:text-text-dark';
        const formattedDate = formatDate(review?.date);
        meta.textContent = formattedDate ? `Bewertet am ${formattedDate}` : 'Bewertung ohne Datumsangabe';
        card.appendChild(meta);

        return card;
      };

      const renderReviews = reviews => {
        listElement.innerHTML = '';

        reviews.forEach(review => {
          const card = createReviewCard(review);
          listElement.appendChild(card);
        });
      };

      const loadReviews = async () => {
        showElement(loadingElement, true);
        showElement(errorElement, false);
        showElement(emptyElement, false);
        showElement(listElement, false);

        try {
          let payload = null;
          let lastError = null;

          for (const endpoint of ENDPOINTS) {
            try {
              const response = await fetch(endpoint, { cache: 'no-store' });
              if (!response.ok) {
                throw new Error(`Serverantwort ${response.status}`);
              }

              payload = await response.json();

              if (payload?.ok === false) {
                const message = payload?.error || 'Die Kundenbewertungen konnten nicht geladen werden.';
                throw new Error(message);
              }

              break;
            } catch (requestError) {
              lastError = requestError;
            }
          }

          if (!payload) {
            throw lastError || new Error('Die Kundenbewertungen konnten nicht geladen werden.');
          }

          const reviews = Array.isArray(payload?.items) ? payload.items : [];

          if (!reviews.length) {
            showElement(emptyElement, true);
            return;
          }

          renderReviews(reviews);
          showElement(listElement, true);
        } catch (error) {
          console.error('Bewertungen konnten nicht geladen werden:', error);
          if (errorElement) {
            errorElement.textContent = 'Die Kundenbewertungen konnten nicht geladen werden. Bitte versuchen Sie es später erneut.';
          }
          showElement(errorElement, true);
        } finally {
          showElement(loadingElement, false);
        }
      };

      loadReviews();
    });
  </script>
<script defer="" src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body></html>
