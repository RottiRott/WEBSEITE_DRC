<!DOCTYPE html>
<html class="scroll-smooth" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Video, Galerie & Leistungen – DachrinneCheck</title>
<!-- FIX: Provide canonical URL for SEO and Wix embedding -->
<link href="https://www.dachrinnecheck.de/" rel="canonical"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#0077B6",
            "primary-dark": "#005E90",
            "background-light": "#F8F9FA",
            "background-dark": "#1A202C",
            "text-light": "#6C757D",
            "text-dark": "#E2E8F0",
            "card-light": "#FFFFFF",
            "card-dark": "#2D3748",
          },
          fontFamily: {
            display: ["Poppins", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
            lg: "0.75rem",
            xl: "1rem",
            full: "9999px",
          },
          boxShadow: {
            'custom': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',
          }
        },
      },
    };
  </script>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<link href="assets/css/responsive-nav.css" rel="stylesheet"/>
<script defer src="assets/js/responsive-nav.js"></script>
<style>
    .text-shadow {
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }
    :root {
      --hero-safe-bottom: 0px;
    }
    @supports (padding: max(0px)) {
      :root {
        --hero-safe-bottom: env(safe-area-inset-bottom);
      }
    }
    /* FIX: Responsive hero media container without parallax tearing */
    .hero-section {
      position: relative;
      isolation: isolate;
      min-height: clamp(24rem, 62vh, 40rem);
      display: grid;
      align-items: center;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .hero-section {
        min-height: clamp(28rem, 70vh, 48rem);
      }
    }
    .hero-media {
      position: absolute;
      inset: 0;
      z-index: -2;
      overflow: hidden;
    }
    .hero-media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
    }
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 24, 47, 0.45), rgba(0, 0, 0, 0.55));
      z-index: -1;
    }
    .hero-content {
      padding: clamp(2.25rem, 8vw, 3.5rem) clamp(1.5rem, 5vw, 4rem)
        max(clamp(1.75rem, 7vw, 3rem), calc(1.75rem + var(--hero-safe-bottom)));
      width: min(100%, 720px);
    }
    @media (min-width: 768px) {
      .hero-content {
        padding: clamp(4rem, 10vw, 7rem) clamp(1.5rem, 5vw, 4rem) clamp(3rem, 8vw, 6.5rem);
      }
    }
    .hero-title {
      font-size: clamp(2.35rem, 8vw, 3.35rem);
      line-height: 1.1;
      letter-spacing: -0.015em;
    }
    @media (min-width: 640px) {
      .hero-title {
        font-size: clamp(2.75rem, 6vw, 4.75rem);
      }
    }
    .hero-subtitle {
      font-size: clamp(1rem, 4.6vw, 1.35rem);
    }
    @media (min-width: 640px) {
      .hero-subtitle {
        font-size: clamp(1.125rem, 3.2vw, 1.75rem);
      }
    }
    .hero-cta {
      gap: clamp(0.75rem, 3vw, 1.25rem);
    }
    @media (min-width: 640px) {
      .hero-cta {
        gap: clamp(1rem, 2vw, 1.75rem);
      }
    }
    @media (max-width: 639px) {
      .hero-cta {
        width: min(100%, 25rem);
        margin-inline: auto;
      }
    }
    [x-cloak] {
      display: none !important;
    }
    .hover-lift {
        transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
    }
    .hover-lift:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 35px -10px rgba(0, 0, 0, 0.15), 0 12px 15px -8px rgba(0, 0, 0, 0.15);
    }
    @keyframes reveal {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .reveal {
      animation: reveal 0.8s ease-out forwards;
      animation-timeline: view();
      animation-range: entry 20% cover 40%;
    }
</style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative w-full overflow-x-hidden">
<section class="py-16 md:py-20 px-4 bg-background-light dark:bg-background-dark reveal">
<div class="container mx-auto">
<div class="text-center max-w-3xl mx-auto mb-12 md:mb-16">
<h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4 md:mb-6">Sehen Sie unsere Arbeit in Aktion</h2>
<p class="text-base md:text-lg text-text-light dark:text-text-dark">Schauen Sie sich unser Video an, um einen Einblick in unseren professionellen Reinigungsprozess und die Ergebnisse zu erhalten, die wir liefern.</p>
</div>
<div class="max-w-4xl mx-auto">
          <div class="rounded-xl overflow-hidden shadow-custom hover-lift">
            <div class="relative w-full" style="padding-top: 56.25%;">
              <video class="absolute inset-0 w-full h-full object-cover" controls preload="metadata" playsinline>
                <source src="https://video.wixstatic.com/video/6d33a0_8388ea3febb544bba1a01ab1de3c0b1a/720p/mp4/file.mp4" type="video/mp4"/>
                Ihr Browser unterstützt das Abspielen dieses Videos nicht.
              </video>
            </div>
          </div>
        </div>
</div>
</section>

<section class="py-16 md:py-20 px-4 bg-card-light dark:bg-card-dark reveal">
<div class="container mx-auto">
<div class="text-center max-w-3xl mx-auto mb-12 md:mb-16">
<h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4 md:mb-6">Sehen Sie den Unterschied</h2>
<p class="text-base md:text-lg text-text-light dark:text-text-dark">Unsere Vorher-Nachher-Galerie zeigt die Qualität und Effektivität unserer Dienstleistungen.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-10">
<div class="rounded-xl overflow-hidden shadow-custom bg-card-light dark:bg-card-dark hover-lift reveal">
<div class="relative">
<img alt="Gutter before cleaning" class="w-full h-64 md:h-72 object-cover" src="https://static.wixstatic.com/media/6d33a0_e6c8065853f1475d97141c103c8f38a5~mv2.png"/>
<div class="absolute top-4 left-4 bg-red-500/80 text-white px-4 py-1 rounded-full text-xs md:text-sm font-semibold">Vorher</div>
</div>
<div class="p-6">
<h3 class="text-lg md:text-xl font-bold text-gray-900 dark:text-white mb-2">Verstopft und Überlaufend</h3>
<p class="text-text-light dark:text-text-dark text-sm md:text-base">Laub, Moos und Schmutz blockierten die Dachrinne vollständig, was zu einem Überlaufen des Wassers führte.</p>
</div>
</div>
<div class="rounded-xl overflow-hidden shadow-custom bg-card-light dark:bg-card-dark hover-lift reveal">
<div class="relative">
<img alt="Gutter after cleaning" class="w-full h-64 md:h-72 object-cover" src="https://static.wixstatic.com/media/6d33a0_b9208eaa790f49fcb1d72fa23dd847be~mv2.png"/>
<div class="absolute top-4 left-4 bg-green-500/80 text-white px-4 py-1 rounded-full text-xs md:text-sm font-semibold">Nachher</div>
</div>
<div class="p-6">
<h3 class="text-lg md:text-xl font-bold text-gray-900 dark:text-white mb-2">Sauber und Frei</h3>
<p class="text-text-light dark:text-text-dark text-sm md:text-base">Nach unserem Service ist die Dachrinne vollständig frei, sodass das Wasser frei fließen kann.</p>
</div>
</div>
</div>
</div>
</section>

<section class="py-16 md:py-20 px-4 bg-background-light dark:bg-background-dark reveal" id="services">
<div class="container mx-auto">
<div class="text-center max-w-3xl mx-auto mb-12 md:mb-16">
<h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4 md:mb-6">Umfassende Dachrinnenpflege</h2>
<p class="text-base md:text-lg text-text-light dark:text-text-dark">Wir bieten eine Reihe von Dienstleistungen an, um sicherzustellen, dass Ihre Dachrinnen in Top-Zustand sind.</p>
</div>
<div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
<div class="bg-card-light dark:bg-card-dark p-8 rounded-xl text-center border border-gray-200 dark:border-gray-700 hover-lift reveal">
<div class="flex justify-center mb-5 text-primary">
<svg fill="currentColor" height="48" viewBox="0 0 256 256" width="48" xmlns="http://www.w3.org/2000/svg">
<path d="M218.83,103.77l-80-75.48a1.14,1.14,0,0,1-.11-.11,16,16,0,0,0-21.53,0l-.11.11L37.17,103.77A16,16,0,0,0,32,115.55V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V160h32v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V115.55A16,16,0,0,0,218.83,103.77ZM208,208H160V160a16,16,0,0,0-16-16H112a16,16,0,0,0-16,16v48H48V115.55l.11-.1L128,40l79.9,75.43.11.1Z"></path>
</svg>
</div>
<h3 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white mb-3">Dachrinnenreinigung</h3>
<p class="text-text-light dark:text-text-dark text-sm md:text-base">Gründliche Reinigung von Dachrinnen und Fallrohren, um Laub und Verstopfungen zu entfernen.</p>
</div>
<div class="bg-card-light dark:bg-card-dark p-8 rounded-xl text-center border border-gray-200 dark:border-gray-700 hover-lift reveal">
<div class="flex justify-center mb-5 text-primary">
<svg fill="currentColor" height="48" viewBox="0 0 256 256" width="48" xmlns="http://www.w3.org/2000/svg">
<path d="M223.45,40.07a8,8,0,0,0-7.52-7.52C139.8,28.08,78.82,51,52.82,94a87.09,87.09,0,0,0-12.76,49c.57,15.92,5.21,32,13.79,47.85l-19.51,19.5a8,8,0,0,0,11.32,11.32l19.5-19.51C81,210.73,97.09,215.37,113,215.94q1.67.06,3.33.06A86.93,86.93,0,0,0,162,203.18C205,177.18,227.93,116.21,223.45,40.07ZM153.75,189.5c-22.75,13.78-49.68,14-76.71.77l88.63-88.62a8,8,0,0,0-11.32-11.32L65.73,179c-13.19-27-13-54,.77-76.71,22.09-36.47,74.6-56.44,141.31-54.06C210.2,114.89,190.22,167.41,153.75,189.5Z"></path>
</svg>
</div>
<h3 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white mb-3">Schmutzentfernung</h3>
<p class="text-text-light dark:text-text-dark text-sm md:text-base">Entfernung aller Abfälle von Ihrem Grundstück, damit es sauber und ordentlich bleibt.</p>
</div>
<div class="bg-card-light dark:bg-card-dark p-8 rounded-xl text-center border border-gray-200 dark:border-gray-700 hover-lift reveal">
<div class="flex justify-center mb-5 text-primary">
<svg fill="currentColor" height="48" viewBox="0 0 256 256" width="48" xmlns="http://www.w3.org/2000/svg">
<path d="M208,40H48A16,16,0,0,0,32,56v58.78c0,89.61,75.82,119.34,91,124.39a15.53,15.53,0,0,0,10,0c15.2-5.05,91-34.78,91-124.39V56A16,16,0,0,0,208,40Zm0,74.79c0,78.42-66.35,104.62-80,109.18-13.53-4.51-80-30.69-80-109.18V56H208ZM82.34,141.66a8,8,0,0,1,11.32-11.32L112,148.68l50.34-50.34a8,8,0,0,1,11.32,11.32l-56,56a8,8,0,0,1-11.32,0Z"></path>
</svg>
</div>
<h3 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white mb-3">Dachrinneninspektion</h3>
<p class="text-text-light dark:text-text-dark text-sm md:text-base">Detaillierte Inspektion Ihrer Dachrinnen, um potenzielle Probleme oder Schäden zu identifizieren.</p>
</div>
</div>
</div>
</section>
</div>

<script>
  const detectFunctionsBase = () => {
    try {
      if (typeof window !== 'undefined') {
        const { hostname = '' } = window.location || {};
        const normalized = String(hostname).toLowerCase();
        if (normalized.includes('wixsite') || normalized.includes('editor')) {
          return '/_functions-dev';
        }
      }
    } catch (error) {
      console.warn('Konnte Umgebung für Functions-Endpunkte nicht bestimmen:', error);
    }
    return '/_functions';
  };

  const FUNCTIONS_BASE = detectFunctionsBase();

  const createReviewEndpoints = limit => {
    const parsedLimit = Number.parseInt(limit, 10);
    const safeLimit = Number.isFinite(parsedLimit) && parsedLimit > 0 ? parsedLimit : 10;
    const alternateBase = FUNCTIONS_BASE === '/_functions' ? '/_functions-dev' : '/_functions';
    const endpoints = [
      `${FUNCTIONS_BASE}/reviews?limit=${safeLimit}`,
      `${alternateBase}/reviews?limit=${safeLimit}`,
      `https://www.dachrinnecheck.de/_functions/reviews?limit=${safeLimit}`
    ];
    return [...new Set(endpoints)];
  };

  const REVIEWS_ENDPOINTS = createReviewEndpoints(20);

  function reviewsCarousel() {
    return {
      reviews: [],
      activeIndex: 0,
      ready: false,
      error: '',
      autoRotateId: null,
      async init() {
        this.stopAutoRotate();
        this.error = '';
        this.ready = false;
        this.reviews = [];

        try {
          let payload = null;
          let lastError = null;

          for (const endpoint of REVIEWS_ENDPOINTS) {
            try {
              const response = await fetch(endpoint, { cache: 'no-store' });
              if (!response.ok) {
                throw new Error(`Konnte Rezensionen nicht laden (Status ${response.status}).`);
              }

              payload = await response.json();

              if (payload?.ok === false) {
                const message = payload?.error || 'Die Kundenrezensionen konnten nicht geladen werden.';
                throw new Error(message);
              }

              break;
            } catch (fetchError) {
              lastError = fetchError;
            }
          }

          if (!payload) {
            throw lastError || new Error('Die Kundenrezensionen konnten nicht geladen werden.');
          }

          const rawItems = Array.isArray(payload?.items) ? payload.items : [];

          if (!rawItems.length) {
            throw new Error('Keine Rezensionen in der Datenquelle gefunden.');
          }

          const formatDate = value => {
            if (!value) {
              return '';
            }
            const date = value instanceof Date ? value : new Date(value);
            if (Number.isNaN(date.getTime())) {
              return typeof value === 'string' ? value : '';
            }
            return date.toLocaleDateString('de-DE', { day: '2-digit', month: 'long', year: 'numeric' });
          };

          const toBoolean = value => {
            if (typeof value === 'string') {
              const normalized = value.trim().toLowerCase();
              return ['true', '1', 'yes', 'ja'].includes(normalized);
            }
            return Boolean(value);
          };

          const normalized = rawItems.map((item, index) => {
            const safeItem = item || {};
            const name = typeof safeItem.name === 'string' ? safeItem.name.trim() : '';
            const comment = typeof safeItem.comment === 'string'
              ? safeItem.comment.trim()
              : (typeof safeItem.text === 'string' ? safeItem.text.trim() : '');
            const ratingSource = safeItem.rating ?? safeItem.score ?? safeItem.stars;
            const ratingValue = Number.parseFloat(ratingSource);

            return {
              id: safeItem.id || `review-${index}`,
              name: name || 'Anonymer Kunde',
              text: comment,
              rating: Number.isFinite(ratingValue) ? ratingValue : 0,
              city: typeof safeItem.city === 'string' ? safeItem.city.trim() : '',
              date: formatDate(safeItem.date),
              source: typeof safeItem.source === 'string' ? safeItem.source.trim() : '',
              link: typeof safeItem.link === 'string' ? safeItem.link.trim() : '',
              avatar: typeof safeItem.avatar === 'string' ? safeItem.avatar.trim() : '',
              highlighted: toBoolean(safeItem.highlighted),
              verified: toBoolean(safeItem.verified)
            };
          });

          const withTexts = normalized.filter(review => review.text.length > 0);

          if (!withTexts.length) {
            throw new Error('Keine veröffentlichten Rezensionstexte vorhanden.');
          }

          this.reviews = withTexts;
          this.shuffleReviews();
          this.ready = true;
          this.startAutoRotate();
        } catch (loadError) {
          console.error(loadError);
          this.error = loadError?.message || 'Die Kundenrezensionen konnten nicht geladen werden.';
        }
      },
      shuffleReviews() {
        for (let index = this.reviews.length - 1; index > 0; index--) {
          const swapIndex = Math.floor(Math.random() * (index + 1));
          [this.reviews[index], this.reviews[swapIndex]] = [this.reviews[swapIndex], this.reviews[index]];
        }
        this.activeIndex = 0;
      },
      next() {
        if (!this.reviews.length) {
          return;
        }
        this.activeIndex = (this.activeIndex + 1) % this.reviews.length;
        this.startAutoRotate();
      },
      previous() {
        if (!this.reviews.length) {
          return;
        }
        this.activeIndex = (this.activeIndex - 1 + this.reviews.length) % this.reviews.length;
        this.startAutoRotate();
      },
      goTo(index) {
        if (typeof index !== 'number' || index < 0 || index >= this.reviews.length) {
          return;
        }
        this.activeIndex = index;
        this.startAutoRotate();
      },
      startAutoRotate() {
        this.stopAutoRotate();
        if (this.reviews.length <= 1) {
          return;
        }
        this.autoRotateId = setInterval(() => {
          if (document.hidden) {
            return;
          }
          this.activeIndex = (this.activeIndex + 1) % this.reviews.length;
        }, 9000);
      },
      stopAutoRotate() {
        if (this.autoRotateId) {
          clearInterval(this.autoRotateId);
          this.autoRotateId = null;
        }
      },
      avatarUrl(review) {
        if (review.avatar) {
          return review.avatar;
        }
        const name = review.name || 'Kunde';
        const initials = encodeURIComponent(name);
        return `https://ui-avatars.com/api/?background=0077B6&color=fff&name=${initials}`;
      },
      starIcon(star, rating) {
        if (rating >= star) {
          return 'star';
        }
        if (rating >= star - 0.5) {
          return 'star_half';
        }
        return 'grade';
      },
      formatMeta(review) {
        const parts = [];
        if (review.city) {
          parts.push(review.city);
        }
        if (review.date) {
          parts.push(review.date);
        }
        return parts.join(' • ');
      }
    };
  }

  document.addEventListener('DOMContentLoaded', () => {
    const contactForm = document.querySelector('#contact-form');
    if (!contactForm) {
      return;
    }

    const firstNameInput = contactForm.querySelector('#first-name');
    const lastNameInput = contactForm.querySelector('#last-name');
    const emailInput = contactForm.querySelector('#email');
    const phoneInput = contactForm.querySelector('#phone');
    const addressInput = contactForm.querySelector('#address');
    const heightInput = contactForm.querySelector('#gutter-height');
    const lengthInput = contactForm.querySelector('#gutter-length');
    const consentInput = contactForm.querySelector('#consent');
    const reasonInputs = Array.from(contactForm.querySelectorAll('input[name="reasons"]'));
    const guardInputs = Array.from(contactForm.querySelectorAll('input[name="guards"]'));
    const submitButton = contactForm.querySelector('button[type="submit"]');
    const statusContainer = contactForm.querySelector('[data-contact-status]');
    const statusMessage = contactForm.querySelector('#contact-status-message');
    const retryButton = contactForm.querySelector('[data-contact-retry]');

    if (!firstNameInput || !lastNameInput || !emailInput || !phoneInput || !addressInput || !heightInput || !lengthInput || !consentInput || !submitButton) {
      return;
    }

    const defaultButtonText = submitButton.textContent.trim();
    let isProcessing = false;

    const statusClassMap = {
      info: ['border-blue-200', 'bg-blue-50', 'text-blue-900', 'dark:bg-blue-900/30', 'dark:border-blue-700', 'dark:text-blue-100'],
      success: ['border-green-300', 'bg-green-50', 'text-green-800', 'dark:bg-green-900/30', 'dark:border-green-700', 'dark:text-green-200'],
      error: ['border-red-300', 'bg-red-50', 'text-red-700', 'dark:bg-red-900/30', 'dark:border-red-700', 'dark:text-red-200']
    };

    const removeStatusClasses = () => {
      if (!statusContainer) {
        return;
      }
      Object.values(statusClassMap).forEach((classes) => {
        classes.forEach((className) => statusContainer.classList.remove(className));
      });
    };

    const toggleRetry = (visible) => {
      if (!retryButton) {
        return;
      }
      retryButton.classList.toggle('hidden', !visible);
      retryButton.setAttribute('aria-hidden', visible ? 'false' : 'true');
    };

    const hideStatus = () => {
      if (!statusContainer) {
        return;
      }
      removeStatusClasses();
      statusContainer.classList.add('hidden');
      statusContainer.removeAttribute('data-state');
      toggleRetry(false);
    };

    // FIX: Present friendly feedback for validation, success and failure states
    const showStatus = (type, message, { showRetry = false } = {}) => {
      if (!statusContainer || !statusMessage) {
        return;
      }
      removeStatusClasses();
      const classes = statusClassMap[type] || statusClassMap.info;
      classes.forEach((className) => statusContainer.classList.add(className));
      statusContainer.classList.remove('hidden');
      statusContainer.dataset.state = type;
      statusMessage.textContent = message;
      toggleRetry(showRetry);
    };

    const setSubmitDisabled = (disabled) => {
      submitButton.disabled = disabled;
      submitButton.setAttribute('aria-disabled', disabled ? 'true' : 'false');
      submitButton.classList.toggle('opacity-60', disabled);
      submitButton.classList.toggle('cursor-not-allowed', disabled);
    };

    const updateSubmitState = () => {
      if (isProcessing) {
        return;
      }
      const shouldDisable = !contactForm.checkValidity();
      setSubmitDisabled(shouldDisable);
      if (!shouldDisable) {
        submitButton.textContent = defaultButtonText;
      }
    };

    const startProcessing = () => {
      isProcessing = true;
      hideStatus();
      setSubmitDisabled(true);
      submitButton.textContent = 'Wird gesendet…';
    };

    const stopProcessing = () => {
      isProcessing = false;
      submitButton.textContent = defaultButtonText;
      updateSubmitState();
    };

    const resetCustomValidity = () => {
      [firstNameInput, lastNameInput, emailInput, phoneInput, addressInput, heightInput, lengthInput].forEach((input) => {
        input.setCustomValidity('');
      });
    };

    const watchInputs = [firstNameInput, lastNameInput, emailInput, phoneInput, addressInput, heightInput, lengthInput];
    watchInputs.forEach((input) => {
      input.addEventListener('input', () => {
        input.setCustomValidity('');
        hideStatus();
        updateSubmitState();
      });
    });

    [consentInput, ...reasonInputs, ...guardInputs].forEach((element) => {
      element.addEventListener('change', () => {
        hideStatus();
        updateSubmitState();
      });
    });

    if (retryButton) {
      retryButton.addEventListener('click', () => {
        if (!isProcessing) {
          hideStatus();
          contactForm.requestSubmit();
        }
      });
    }

    const parseNumberInput = input => {
      if (!input) {
        return null;
      }
      const rawValue = input.value.replace(',', '.').trim();
      if (!rawValue) {
        return null;
      }
      const numericValue = Number.parseFloat(rawValue);
      return Number.isFinite(numericValue) ? numericValue : null;
    };

    contactForm.addEventListener('submit', async event => {
      event.preventDefault();

      hideStatus();
      resetCustomValidity();

      const errors = [];
      const firstName = firstNameInput.value.trim();
      const lastName = lastNameInput.value.trim();
      const emailValue = emailInput.value.trim();
      const phoneValue = phoneInput.value.trim();
      const addressValue = addressInput.value.trim();
      const heightValue = parseNumberInput(heightInput);
      const lengthValue = parseNumberInput(lengthInput);

      if (!firstName) {
        firstNameInput.setCustomValidity('Bitte geben Sie Ihren Vornamen an.');
        errors.push('Bitte geben Sie Ihren Vornamen an.');
      }

      if (!lastName) {
        lastNameInput.setCustomValidity('Bitte geben Sie Ihren Nachnamen an.');
        errors.push('Bitte geben Sie Ihren Nachnamen an.');
      }

      if (!emailValue) {
        emailInput.setCustomValidity('Bitte geben Sie Ihre E-Mail-Adresse an.');
        errors.push('Bitte geben Sie Ihre E-Mail-Adresse an.');
      } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailValue)) {
        emailInput.setCustomValidity('Bitte geben Sie eine gültige E-Mail-Adresse an.');
        errors.push('Bitte geben Sie eine gültige E-Mail-Adresse an.');
      }

      if (!phoneValue) {
        phoneInput.setCustomValidity('Bitte geben Sie eine Telefonnummer an.');
        errors.push('Bitte geben Sie eine Telefonnummer an.');
      } else if (!/^\+?[0-9 ()\-\/]{6,20}$/.test(phoneValue)) {
        phoneInput.setCustomValidity('Bitte prüfen Sie die Telefonnummer.');
        errors.push('Bitte prüfen Sie die Telefonnummer.');
      }

      if (!addressValue) {
        addressInput.setCustomValidity('Bitte geben Sie eine Adresse an.');
        errors.push('Bitte geben Sie eine Adresse an.');
      }

      if (heightValue === null || heightValue <= 0) {
        heightInput.setCustomValidity('Bitte geben Sie die geschätzte Höhe der Dachrinne an.');
        errors.push('Bitte geben Sie die geschätzte Höhe der Dachrinne an.');
      }

      if (lengthValue === null || lengthValue <= 0) {
        lengthInput.setCustomValidity('Bitte geben Sie die geschätzte Länge der Dachrinne an.');
        errors.push('Bitte geben Sie die geschätzte Länge der Dachrinne an.');
      }

      if (!consentInput.checked) {
        errors.push('Bitte bestätigen Sie die Datenschutzerklärung.');
      }

      if (errors.length) {
        contactForm.reportValidity();
        showStatus('error', errors.join(' '));
        updateSubmitState();
        return;
      }

      const selectedReasons = reasonInputs.filter(input => input.checked).map(input => input.value);
      const selectedGuards = guardInputs.filter(input => input.checked).map(input => input.value);
      const messageParts = [];
      if (selectedReasons.length) {
        messageParts.push(`Grund für die Reinigung: ${selectedReasons.join(', ')}`);
      }
      if (selectedGuards.length) {
        messageParts.push(`Dachrinnenschutz: ${selectedGuards.join(', ')}`);
      }
      const messageValue = messageParts.join(' | ');

      startProcessing();

      const contact = {
        vorname: firstName,
        nachname: lastName,
        email: emailValue,
        telefon: phoneValue,
        nachricht: messageValue,
        wunschtermin: ''
      };

      const payload = {
        typ: 'Homepage-Anfrage',
        adresse: addressValue,
        hoehe: heightValue,
        lfm: lengthValue,
        gruende: selectedReasons,
        schutzOptionen: selectedGuards
      };

      const requestBody = {
        meta: {
          source: 'homepage-form',
          version: '2.0.0',
          timestamp: new Date().toISOString()
        },
        contact,
        payload,
        consent: consentInput.checked ? 'ja' : 'nein'
      };

      try {
        const response = await fetch('/_functions/webhookbridge', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });

        let result = null;
        try {
          result = await response.json();
        } catch (jsonError) {
          // ignore JSON parsing errors – will be handled by status check below
        }

        if (!response.ok || (result && result.ok === false)) {
          const errorMessage = result?.error || `Unerwarteter Status ${response.status}`;
          throw new Error(errorMessage);
        }

        showStatus('success', 'Vielen Dank für Ihre Anfrage! Wir melden uns schnellstmöglich bei Ihnen.');
        contactForm.reset();
        updateSubmitState();
      } catch (error) {
        console.error('Fehler beim Senden des Formulars:', error);
        showStatus('error', 'Ihre Anfrage konnte nicht gesendet werden. Bitte versuchen Sie es später erneut.', { showRetry: true });
      } finally {
        stopProcessing();
      }
    });

    updateSubmitState();
  });

    document.addEventListener('DOMContentLoaded', () => {
      const reviewsSection = document.querySelector('#dynamic-reviews');
      if (!reviewsSection) {
        return;
      }

      const listElement = reviewsSection.querySelector('#reviews-list');
      const loadingElement = reviewsSection.querySelector('#reviews-loading');
      const errorElement = reviewsSection.querySelector('#reviews-error');
      const emptyElement = reviewsSection.querySelector('#reviews-empty');

      if (!listElement) {
        return;
      }

      const ENDPOINTS = createReviewEndpoints(10);

      const showElement = (element, shouldShow) => {
        if (!element) {
          return;
        }
        if (shouldShow) {
          element.classList.remove('hidden');
        } else {
          element.classList.add('hidden');
        }
      };

      const formatDate = value => {
        if (!value) {
          return '';
        }
        const date = value instanceof Date ? value : new Date(value);
        if (Number.isNaN(date.getTime())) {
          return '';
        }
        return date.toLocaleDateString('de-DE', { day: '2-digit', month: 'long', year: 'numeric' });
      };

      const clampRating = value => {
        const numeric = Number.parseFloat(value);
        if (!Number.isFinite(numeric)) {
          return 0;
        }
        return Math.min(Math.max(numeric, 0), 5);
      };

      const createStarRow = ratingValue => {
        const rating = clampRating(ratingValue);
        const container = document.createElement('div');
        container.className = 'flex items-center gap-1 text-yellow-400';
        container.setAttribute('aria-label', `${Math.round(rating * 10) / 10} von 5 Sternen`);

        for (let index = 1; index <= 5; index += 1) {
          const span = document.createElement('span');
          span.className = 'material-symbols-outlined text-xl';
          if (rating >= index) {
            span.textContent = 'star';
          } else if (rating >= index - 0.5) {
            span.textContent = 'star_half';
          } else {
            span.textContent = 'star_border';
          }
          container.appendChild(span);
        }

        const label = document.createElement('span');
        label.className = 'ml-2 text-sm font-medium text-text-light dark:text-text-dark';
        label.textContent = `${Math.round(rating * 10) / 10} / 5`;
        container.appendChild(label);

        return container;
      };

      const createReviewCard = review => {
        const card = document.createElement('article');
        card.className = 'bg-background-light dark:bg-background-dark border border-gray-200 dark:border-gray-700 rounded-xl p-6 shadow-sm flex flex-col gap-4';

        const name = document.createElement('h4');
        name.className = 'text-lg font-semibold text-gray-900 dark:text-white';
        name.textContent = review?.name || 'Kunde';
        card.appendChild(name);

        card.appendChild(createStarRow(review?.rating));

        if (review?.comment) {
          const comment = document.createElement('p');
          comment.className = 'text-sm md:text-base text-text-light dark:text-text-dark italic';
          comment.textContent = review.comment;
          card.appendChild(comment);
        }

        const meta = document.createElement('p');
        meta.className = 'text-xs text-text-light dark:text-text-dark';
        const formattedDate = formatDate(review?.date);
        meta.textContent = formattedDate ? `Bewertet am ${formattedDate}` : 'Bewertung ohne Datumsangabe';
        card.appendChild(meta);

        return card;
      };

      const renderReviews = reviews => {
        listElement.innerHTML = '';

        reviews.forEach(review => {
          const card = createReviewCard(review);
          listElement.appendChild(card);
        });
      };

      const loadReviews = async () => {
        showElement(loadingElement, true);
        showElement(errorElement, false);
        showElement(emptyElement, false);
        showElement(listElement, false);

        try {
          let payload = null;
          let lastError = null;

          for (const endpoint of ENDPOINTS) {
            try {
              const response = await fetch(endpoint, { cache: 'no-store' });
              if (!response.ok) {
                throw new Error(`Serverantwort ${response.status}`);
              }

              payload = await response.json();

              if (payload?.ok === false) {
                const message = payload?.error || 'Die Kundenbewertungen konnten nicht geladen werden.';
                throw new Error(message);
              }

              break;
            } catch (requestError) {
              lastError = requestError;
            }
          }

          if (!payload) {
            throw lastError || new Error('Die Kundenbewertungen konnten nicht geladen werden.');
          }

          const reviews = Array.isArray(payload?.items) ? payload.items : [];

          if (!reviews.length) {
            showElement(emptyElement, true);
            return;
          }

          renderReviews(reviews);
          showElement(listElement, true);
        } catch (error) {
          console.error('Bewertungen konnten nicht geladen werden:', error);
          if (errorElement) {
            errorElement.textContent = 'Die Kundenbewertungen konnten nicht geladen werden. Bitte versuchen Sie es später erneut.';
          }
          showElement(errorElement, true);
        } finally {
          showElement(loadingElement, false);
        }
      };

      loadReviews();
    });
  </script>
<script defer="" src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body></html>
