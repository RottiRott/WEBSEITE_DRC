<section class="py-16 md:py-20 px-4 bg-card-light dark:bg-card-dark reveal">
  <div class="container mx-auto">
    <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 md:mb-6 text-gray-900 dark:text-white">Was unsere Kunden sagen</h2>
    <p class="text-base md:text-lg text-text-light dark:text-text-dark text-center mb-8 md:mb-12 max-w-2xl mx-auto">Hören Sie von unseren zufriedenen Kunden und erfahren Sie, warum sie DachrinneCheck vertrauen.</p>
    <div class="relative max-w-3xl mx-auto" x-data="reviewsCarousel()" x-init="init()" x-cloak>
      <div class="bg-white/70 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 text-center rounded-xl py-8" x-show="!ready && !error">
        <p class="font-medium">Kundenstimmen werden geladen …</p>
      </div>
      <div class="bg-red-50 border border-red-200 text-red-700 dark:bg-red-900/30 dark:border-red-700 dark:text-red-200 rounded-xl p-6 text-center" x-show="error" x-transition>
        <p class="font-semibold" x-text="error"></p>
      </div>
      <div @mouseenter="stopAutoRotate()" @mouseleave="startAutoRotate()" class="relative" x-show="ready" x-transition>
        <div class="overflow-hidden">
          <div :style="`transform: translateX(-${activeIndex * 100}%)`" class="flex transition-transform duration-500 ease-in-out">
            <template x-for="(review, index) in reviews" :key="review.id || index">
              <div class="flex-shrink-0 w-full p-2">
                <div class="bg-background-light dark:bg-background-dark rounded-xl shadow-custom p-6 md:p-8 text-center hover-lift relative">
                  <template x-if="review.highlighted">
                    <span class="absolute top-4 right-4 bg-primary text-white text-xs font-semibold uppercase tracking-wide px-3 py-1 rounded-full">Top-Bewertung</span>
                  </template>
                  <div class="flex justify-center mb-4">
                    <img :alt="`Avatar von ${review.name}`" :src="avatarUrl(review)" class="w-20 h-20 md:w-24 md:h-24 rounded-full object-cover border-4 border-white shadow"/>
                  </div>
                  <div class="flex flex-wrap justify-center items-center gap-2 mb-3" x-show="review.verified || review.source">
                    <template x-if="review.verified">
                      <span class="flex items-center text-xs font-semibold text-green-700 bg-green-100 dark:text-green-200 dark:bg-green-900/60 px-3 py-1 rounded-full">
                        <span class="material-symbols-outlined text-base mr-1">verified</span>
                        Verifiziert
                      </span>
                    </template>
                    <template x-if="review.source">
                      <span class="text-xs text-text-light dark:text-text-dark px-3 py-1 rounded-full border border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-800/70" x-text="review.source"></span>
                    </template>
                  </div>
                  <div class="flex justify-center text-yellow-400 mb-4">
                    <template x-for="star in 5" :key="`${review.id || index}-star-${star}`">
                      <span class="material-symbols-outlined" x-text="starIcon(star, review.rating)"></span>
                    </template>
                  </div>
                  <p class="text-base md:text-lg text-text-light dark:text-text-dark italic mb-4">&bdquo;<span x-text="review.text"></span>&ldquo;</p>
                  <p class="font-bold text-gray-900 dark:text-white" x-text="review.name"></p>
                  <p class="text-sm text-text-light dark:text-text-dark mb-3" x-text="formatMeta(review)"></p>
                  <template x-if="review.link">
                    <p class="text-sm">
                      <a :href="review.link" class="text-primary hover:text-primary-dark font-medium inline-flex items-center gap-1" rel="noopener" target="_blank">
                        Original lesen
                        <span class="material-symbols-outlined text-base">open_in_new</span>
                      </a>
                    </p>
                  </template>
                </div>
              </div>
            </template>
          </div>
        </div>
        <button :aria-disabled="reviews.length <= 1" :class="{'opacity-40 cursor-not-allowed': reviews.length <= 1}" @click="previous" class="absolute top-1/2 -translate-y-1/2 left-0 -translate-x-4 md:-translate-x-1/2 bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition transform hover:scale-110" type="button">
          <span class="material-symbols-outlined text-primary">chevron_left</span>
        </button>
        <button :aria-disabled="reviews.length <= 1" :class="{'opacity-40 cursor-not-allowed': reviews.length <= 1}" @click="next" class="absolute top-1/2 -translate-y-1/2 right-0 translate-x-4 md:translate-x-1/2 bg-white dark:bg-gray-800 rounded-full p-2 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition transform hover:scale-110" type="button">
          <span class="material-symbols-outlined text-primary">chevron_right</span>
        </button>
      </div>
      <div class="flex justify-center space-x-2 mt-6 md:mt-8" x-show="ready && reviews.length > 1">
        <template x-for="(review, index) in reviews" :key="`${review.id || index}-indicator`">
          <button :aria-label="`Bewertung ${index + 1} anzeigen`" :class="{'bg-primary scale-110': activeIndex === index, 'bg-gray-300 dark:bg-gray-600': activeIndex !== index}" @click="goTo(index)" class="w-3 h-3 rounded-full transition transform" type="button"></button>
        </template>
      </div>
    </div>
    <div class="mt-12" id="dynamic-reviews">
      <div class="text-center max-w-3xl mx-auto mb-8">
        <h3 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white">Aktuelle Kundenbewertungen</h3>
        <p class="text-base md:text-lg text-text-light dark:text-text-dark">Echte Rückmeldungen aus unserer Reviews-CMS-Sammlung – automatisch aktualisiert.</p>
      </div>
      <div class="max-w-4xl mx-auto space-y-6">
        <div class="bg-white/70 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 rounded-xl p-6 text-center" id="reviews-loading">
          <p class="font-medium">Bewertungen werden geladen …</p>
        </div>
        <div class="hidden bg-red-50 border border-red-200 text-red-700 dark:bg-red-900/30 dark:border-red-700 dark:text-red-200 rounded-xl p-6 text-center" id="reviews-error"></div>
        <div class="hidden text-text-light dark:text-text-dark text-center" id="reviews-empty">Noch keine veröffentlichten Bewertungen vorhanden.</div>
        <div class="grid gap-6 md:grid-cols-2" id="reviews-list"></div>
      </div>
    </div>
  </div>
</section>
